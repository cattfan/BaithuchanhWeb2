using BaithuchanhWeb2.Models.Domain;
using Microsoft.EntityFrameworkCore;

namespace BaithuchanhWeb2.Data
{
    public class AppDbContext : DbContext
    {
        public AppDbContext(DbContextOptions<AppDbContext> dbContextOptions) : base(dbContextOptions)
        {
            //constructor
        }
        //define C# model
        protected override void OnModelCreating(ModelBuilder modelBuilder)
        {
            // có thể định nghĩa quan hệ giữa các table bằng Fluent API
            modelBuilder.Entity<Book_Author>().HasOne(ba => ba.Book)
                .WithMany(b => b.Book_Authors)
                .HasForeignKey(bi => bi.BookId);

            modelBuilder.Entity<Book_Author>().HasOne(b => b.Author)
                .WithMany(ba => ba.Book_Authors)
                .HasForeignKey(bi => bi.AuthorId);

            // Seed Data - Dữ liệu mẫu
            SeedData(modelBuilder);
        }

        private void SeedData(ModelBuilder modelBuilder)
        {
            // Seed Publishers
            modelBuilder.Entity<Publishers>().HasData(
                new Publishers { Id = 1, Name = "NXB Kim Đồng" },
                new Publishers { Id = 2, Name = "NXB Trẻ" },
                new Publishers { Id = 3, Name = "NXB Văn học" },
                new Publishers { Id = 4, Name = "NXB Giáo dục Việt Nam" },
                new Publishers { Id = 5, Name = "NXB Hội Nhà văn" }
            );

            // Seed Authors
            modelBuilder.Entity<Authors>().HasData(
                new Authors { Id = 1, FullName = "Nguyễn Nhật Ánh" },
                new Authors { Id = 2, FullName = "Tô Hoài" },
                new Authors { Id = 3, FullName = "Nam Cao" },
                new Authors { Id = 4, FullName = "Ngô Tất Tố" },
                new Authors { Id = 5, FullName = "Vũ Trọng Phụng" },
                new Authors { Id = 6, FullName = "Nguyễn Du" },
                new Authors { Id = 7, FullName = "Xuân Quỳnh" },
                new Authors { Id = 8, FullName = "Hồ Chí Minh" }
            );

            // Seed Books
            modelBuilder.Entity<Book>().HasData(
                new Book
                {
                    Id = 1,
                    Title = "Kính vạn hoa",
                    Description = "Một cuốn sách hay về tuổi thơ và những kỷ niệm đẹp",
                    IsRead = true,
                    DateRead = new DateTime(2023, 5, 15),
                    Rate = 5,
                    Genre = "Văn học thiếu nhi",
                    CoverUrl = "https://example.com/kinh-van-hoa.jpg",
                    DateAdded = new DateTime(2023, 1, 10),
                    PublisherId = 1
                },
                new Book
                {
                    Id = 2,
                    Title = "Dế Mèn phiêu lưu ký",
                    Description = "Cuốn sách kinh điển về cuộc phiêu lưu của chú dế Mèn",
                    IsRead = true,
                    DateRead = new DateTime(2023, 6, 20),
                    Rate = 5,
                    Genre = "Văn học thiếu nhi",
                    CoverUrl = "https://example.com/de-men.jpg",
                    DateAdded = new DateTime(2023, 2, 15),
                    PublisherId = 2
                },
                new Book
                {
                    Id = 3,
                    Title = "Chí Phèo",
                    Description = "Tác phẩm nổi tiếng của Nam Cao về số phận con người",
                    IsRead = true,
                    DateRead = new DateTime(2023, 8, 20),
                    Rate = 4,
                    Genre = "Văn học hiện đại",
                    CoverUrl = "https://example.com/chi-pheo.jpg",
                    DateAdded = new DateTime(2023, 3, 5),
                    PublisherId = 3
                },
                new Book
                {
                    Id = 4,
                    Title = "Tắt đèn",
                    Description = "Tiểu thuyết đầu tay của Ngô Tất Tố về đời sống nông thôn",
                    IsRead = false,
                    DateRead = null,
                    Rate = null,
                    Genre = "Văn học hiện đại",
                    CoverUrl = "https://example.com/tat-den.jpg",
                    DateAdded = new DateTime(2023, 4, 12),
                    PublisherId = 3
                },
                new Book
                {
                    Id = 5,
                    Title = "Số đỏ",
                    Description = "Tác phẩm châm biếm xã hội của Vũ Trọng Phụng",
                    IsRead = true,
                    DateRead = new DateTime(2023, 9, 10),
                    Rate = 4,
                    Genre = "Văn học hiện đại",
                    CoverUrl = "https://example.com/so-do.jpg",
                    DateAdded = new DateTime(2023, 5, 20),
                    PublisherId = 4
                },
                new Book
                {
                    Id = 6,
                    Title = "Truyện Kiều",
                    Description = "Kiệt tác văn học cổ điển Việt Nam",
                    IsRead = false,
                    DateRead = null,
                    Rate = null,
                    Genre = "Văn học cổ điển",
                    CoverUrl = "https://example.com/truyen-kieu.jpg",
                    DateAdded = new DateTime(2023, 6, 8),
                    PublisherId = 5
                },
                new Book
                {
                    Id = 7,
                    Title = "Sóng",
                    Description = "Tập thơ nổi tiếng của nhà thơ Xuân Quỳnh",
                    IsRead = true,
                    DateRead = new DateTime(2023, 10, 5),
                    Rate = 5,
                    Genre = "Thơ",
                    CoverUrl = "https://example.com/song.jpg",
                    DateAdded = new DateTime(2023, 7, 25),
                    PublisherId = 5
                }
            );

            // Seed Book_Author relationships
            modelBuilder.Entity<Book_Author>().HasData(
                new Book_Author { Id = 1, BookId = 1, AuthorId = 1 }, // Kính vạn hoa - Nguyễn Nhật Ánh
                new Book_Author { Id = 2, BookId = 2, AuthorId = 2 }, // Dế Mèn - Tô Hoài
                new Book_Author { Id = 3, BookId = 3, AuthorId = 3 }, // Chí Phèo - Nam Cao
                new Book_Author { Id = 4, BookId = 4, AuthorId = 4 }, // Tắt đèn - Ngô Tất Tố
                new Book_Author { Id = 5, BookId = 5, AuthorId = 5 }, // Số đỏ - Vũ Trọng Phụng
                new Book_Author { Id = 6, BookId = 6, AuthorId = 6 }, // Truyện Kiều - Nguyễn Du
                new Book_Author { Id = 7, BookId = 7, AuthorId = 7 }  // Sóng - Xuân Quỳnh
            );
        }

        public DbSet<Book> Books { get; set; }
        public DbSet<Authors> Authors { get; set; }
        public DbSet<Book_Author> Books_Authors { get; set; }
        public DbSet<Publishers> Publishers { get; set; }
    }
}
